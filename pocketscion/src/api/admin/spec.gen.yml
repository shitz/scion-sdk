# GENERATED FILE DO NOT EDIT
# This file was generated by the `generate_openapi` test in `src/api/admin/api.rs`
openapi: 3.1.0
info:
  title: Pocket SCION Management API
  description: Management API for Pocket SCION
  contact:
    name: Anapaya Operations
    email: ops@anapaya.net
  license:
    name: Apache-2.0
    identifier: Apache-2.0
  version: 0.2.0
servers:
- url: http://{host}:{port}/api/v1
paths:
  /auth_server:
    get:
      tags:
      - management
      summary: Fake authorization server details.
      operationId: get_auth_server
      responses:
        '200':
          description: Authorization Server details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthServerResponse'
        '404':
          description: No Authorization Server running
  /endhost_apis:
    get:
      tags:
      - management
      operationId: get_endhost_apis
      responses:
        '200':
          description: The pocket SCION endhost APIs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EndhostApisResponse'
  /io_config:
    get:
      tags:
      - management
      summary: Get the current pocket SCION I/O config.
      operationId: get_io_config
      responses:
        '200':
          description: The pocket SCION I/O config
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IoConfigDto'
  /snaps:
    get:
      tags:
      - management
      summary: List all available SNAPs of the Pocket SCION.
      operationId: get_snaps
      responses:
        '200':
          description: List all available SNAPs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SnapsResponse'
  /status:
    get:
      tags:
      - management
      summary: Status of the Pocket SCION service.
      operationId: get_status
      responses:
        '200':
          description: Pocket SCION status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
  /system_state:
    get:
      tags:
      - management
      summary: Get the current pocket SCION system state.
      operationId: get_system_state
      responses:
        '200':
          description: The pocket SCION system state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStateDto'
components:
  schemas:
    AddrRangeDto:
      type: object
      description: An address range.
      required:
      - start
      - end
      properties:
        end:
          type: integer
          description: The end of the address range.
          minimum: 0
        start:
          type: integer
          description: The start of the address range.
          minimum: 0
    AddrSetDto:
      type: object
      description: An address set.
      required:
      - prefix
      - free
      properties:
        free:
          type: array
          items:
            $ref: '#/components/schemas/AddrRangeDto'
          description: The list of free addresses ranges.
        prefix:
          type: string
          description: The prefix of the address set.
    AddressAllocatorDto:
      type: object
      description: The address allocator.
      required:
      - v4
      - v6
      - rng
      properties:
        rng:
          $ref: '#/components/schemas/RngDto'
          description: The random number generator state.
        v4:
          type: array
          items:
            $ref: '#/components/schemas/AddrSetDto'
          description: The list of IPv4 address sets.
        v6:
          type: array
          items:
            $ref: '#/components/schemas/AddrSetDto'
          description: The list of IPv6 address sets.
    AddressGrantDto:
      type: object
      description: An address grant.
      required:
      - endhost_addr
      - id
      properties:
        endhost_addr:
          type: string
          description: The endhost address.
        id:
          type: string
          description: The ID of the token that was used to retrieve this address grant.
        on_hold_until:
          type:
          - string
          - 'null'
          description: The duration for which the grant is kept on hold.
    AddressManagerDto:
      type: object
      description: The data plane address registry.
      required:
      - isd_as
      - hold_duration
      - address_grants
      - free_ips
      - max_attempts
      - prefixes
      properties:
        address_grants:
          type: array
          items:
            $ref: '#/components/schemas/AddressGrantDto'
          description: The list of address grants.
        free_ips:
          $ref: '#/components/schemas/AddressAllocatorDto'
          description: Bookkeeping of free IP addresses.
        hold_duration:
          type: string
          description: The duration for which an address is held.
        isd_as:
          $ref: '#/components/schemas/IsdAsn'
          description: The ISD-AS of the data plane.
        max_attempts:
          type: integer
          description: The maximum number of attempts to allocate an address.
          minimum: 0
        prefixes:
          type: array
          items:
            $ref: '#/components/schemas/IpNetDto'
          description: Prefixes this AddressManager is responsible for.
    AuthServerResponse:
      type: object
      description: Authorization server response.
      required:
      - addr
      properties:
        addr:
          type: string
          description: Address of the authorization server.
    AuthServerStateDto:
      type: object
      description: The state of the authentication server.
      required:
      - token_exchanger
      properties:
        token_exchanger:
          $ref: '#/components/schemas/TokenExchangerStateDto'
          description: The token exchange state.
    DataPlaneId:
      type: integer
      description: Data plane identifier.
      minimum: 0
    DataPlaneStateDto:
      type: object
      description: The SNAP data plane state.
      required:
      - address_registries
      properties:
        address_registries:
          type: array
          items:
            $ref: '#/components/schemas/AddressManagerDto'
          description: The address registries (per ISD AS) of the data plane.
    EndhostApiId:
      type: integer
      description: Endhost API instance identifier.
      minimum: 0
    EndhostApiResponseEntry:
      type: object
      description: Endhost API information.
      required:
      - id
      - local_ases
      - url
      properties:
        id:
          $ref: '#/components/schemas/EndhostApiId'
          description: The ID of the Endhost API.
        local_ases:
          type: array
          items:
            $ref: '#/components/schemas/IsdAsn'
          description: The local ASes the Endhost API serves.
          uniqueItems: true
        url:
          type: string
          format: uri
          description: The URL of the Endhost API.
    EndhostApiState:
      type: object
      description: State per EndhostAPI instance
      required:
      - local_ases
      properties:
        local_ases:
          type: array
          items:
            $ref: '#/components/schemas/IsdAsn'
          uniqueItems: true
    EndhostApisResponse:
      type: object
      description: Response for the endhost APIs.
      required:
      - endhost_apis
      properties:
        endhost_apis:
          type: object
          description: Map of endhost APIs.
          additionalProperties:
            $ref: '#/components/schemas/EndhostApiResponseEntry'
          propertyNames:
            type: integer
            description: Endhost API instance identifier.
            minimum: 0
    FakeIdpDto:
      type: object
      description: The fake identity provider configuration for testing.
      required:
      - public_key
      properties:
        public_key:
          type: string
          description: The public key (PEM format) used to verify ID tokens.
    IoAuthServerConfigDto:
      type: object
      description: The I/O configuration of the Auth server.
      properties:
        addr:
          type:
          - string
          - 'null'
    IoConfigDto:
      type: object
      description: The pocket SCION I/O configuration.
      required:
      - auth_server
      - snaps
      - router_sockets
      - endhost_apis
      properties:
        auth_server:
          $ref: '#/components/schemas/IoAuthServerConfigDto'
          description: The I/O state of the optional Auth server.
        endhost_apis:
          type: object
          description: Listening Sockets for Endhost APIs
          additionalProperties:
            type: string
          propertyNames:
            type: integer
            description: Endhost API instance identifier.
            minimum: 0
        router_sockets:
          type: object
          description: The list of SCION router sockets.
          additionalProperties:
            type: string
          propertyNames:
            type: integer
            description: The router identifier.
            minimum: 0
        snaps:
          type: object
          description: The list of SNAP I/O configurations.
          additionalProperties:
            $ref: '#/components/schemas/IoSnapConfigDto'
          propertyNames:
            type: integer
            description: The SNAP identifier.
            minimum: 0
    IoControlPlaneConfigDto:
      type: object
      description: The I/O configuration of a SNAP control plane.
      properties:
        api_addr:
          type:
          - string
          - 'null'
          description: The Control plane API address.
    IoDataPlaneConfigDto:
      type: object
      description: The I/O configuration of a SNAP data plane.
      properties:
        addr:
          type:
          - string
          - 'null'
          description: The data plane address.
    IoSnapConfigDto:
      type: object
      description: The I/O configuration of a SNAP.
      required:
      - control_plane
      - data_planes
      properties:
        control_plane:
          $ref: '#/components/schemas/IoControlPlaneConfigDto'
          description: The control plane address of the SNAP.
        data_planes:
          type: object
          description: The list of data plane I/O configurations.
          additionalProperties:
            $ref: '#/components/schemas/IoDataPlaneConfigDto'
          propertyNames:
            type: integer
            description: Data plane identifier.
            minimum: 0
    IpNetDto:
      type: string
      description: IP network.
    IsdAsn:
      type: string
      description: |-
        The combined ISD and AS identifier of a SCION AS (sometimes abbreviated as IA).

        # Examples

        ```
        # use scion_proto::address::IsdAsn;
        #
        # fn main() -> Result<(), Box<dyn std::error::Error>> {
        assert_eq!(IsdAsn(0x1_ff00_0000_0110), "1-ff00:0:110".parse()?);
        # Ok(())
        # }
        ```
      examples:
      - 1-ff00:0:110
      pattern: ^\d+-([a-f0-9]{1,4}:){2}([a-f0-9]{1,4})|\d+$
    ReadyState:
      type: string
      description: PocketSCION ready state.
      enum:
      - Ready
      - NotReady
    RngDto:
      type: object
      description: The random number generator state.
      required:
      - seed
      - word
      - stream
      properties:
        seed:
          type: string
        stream:
          type: integer
          format: int64
          minimum: 0
        word:
          type: integer
          minimum: 0
    RouterStateDto:
      type: object
      description: The state of a SCION router emulated by PocketScion.
      required:
      - isd_as
      - if_ids
      properties:
        if_ids:
          type: array
          items:
            type: integer
            format: int32
            minimum: 0
          description: The list of interface IDs of the router.
        isd_as:
          $ref: '#/components/schemas/IsdAsn'
          description: The ISD-AS of the router.
    ScionAsDto:
      type: object
      description: Human readable Pocket SCION AS
      required:
      - isd_asn
      - is_core_as
      - forwarding_key
      properties:
        forwarding_key:
          type: array
          items:
            type: integer
            format: int32
            minimum: 0
        is_core_as:
          type: boolean
        isd_asn:
          $ref: '#/components/schemas/IsdAsn'
    ScionTopologyDto:
      type: object
      description: Human readable ScionTopology
      required:
      - as_list
      - links
      properties:
        as_list:
          type: array
          items:
            $ref: '#/components/schemas/ScionAsDto'
        links:
          type: array
          items:
            $ref: '#/components/schemas/pocketscion::network::scion::topology::dto::ScionLinkDto'
    SessionDto:
      type: object
      description: Data plane session.
      required:
      - session_id
      - expiry
      properties:
        expiry:
          type: integer
          format: int64
          description: The expiry time of the session represented as a Unix timestamp.
          minimum: 0
        session_id:
          $ref: '#/components/schemas/SessionIdDto'
          description: The ID of the session.
    SessionIdDto:
      type: object
      description: Session ID.
      required:
      - pssid
      - data_plane_id
      properties:
        data_plane_id:
          $ref: '#/components/schemas/DataPlaneId'
          description: The ID of the data plane.
        pssid:
          type: string
          description: The pseudo SCION subscriber identity (PSSID).
    SessionManagerStateDto:
      type: object
      description: The session manager state.
      required:
      - session_duration
      - sessions
      properties:
        session_duration:
          type: string
          description: The maximum duration of a session.
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/SessionDto'
          description: List of existing sessions.
    SessionTokenIssuerStateDto:
      type: object
      description: Session token issuer state.
      required:
      - key
      properties:
        key:
          type: string
          description: The encoding key (PEM format) used to issue session tokens.
    Snap:
      type: object
      description: SNAP in pocketSCION.
      required:
      - control_plane_api
      properties:
        control_plane_api:
          type: string
          description: SNAP control plane API address.
    SnapStateDto:
      type: object
      description: The state of a SNAP.
      required:
      - session_manager
      - session_issuer
      - data_planes
      properties:
        data_planes:
          type: object
          description: The list of SNAP data planes.
          additionalProperties:
            $ref: '#/components/schemas/DataPlaneStateDto'
          propertyNames:
            type: integer
            description: Data plane identifier.
            minimum: 0
        session_issuer:
          $ref: '#/components/schemas/SessionTokenIssuerStateDto'
          description: Session token issuer state.
        session_manager:
          $ref: '#/components/schemas/SessionManagerStateDto'
          description: Session manager state.
    SnapsResponse:
      type: object
      description: SNAP response.
      required:
      - snaps
      properties:
        snaps:
          type: object
          description: Map of SNAPs.
          additionalProperties:
            $ref: '#/components/schemas/Snap'
          propertyNames:
            type: integer
            description: The SNAP identifier.
            minimum: 0
    StatusResponse:
      type: object
      description: Status response.
      required:
      - state
      properties:
        state:
          $ref: '#/components/schemas/ReadyState'
          description: The current ready state of pocketSCION.
    SystemStateDto:
      type: object
      description: The pocket SCION system state.
      required:
      - snap_token_public_key
      - snaps
      - routers
      - endhost_apis
      properties:
        auth_server_state:
          oneOf:
          - type: 'null'
          - $ref: '#/components/schemas/AuthServerStateDto'
            description: Test authentication server.
        endhost_apis:
          type: object
          description: The list of Endhost APIs
          additionalProperties:
            $ref: '#/components/schemas/EndhostApiState'
          propertyNames:
            type: integer
            description: Endhost API instance identifier.
            minimum: 0
        routers:
          type: object
          description: The list of SCION routers.
          additionalProperties:
            $ref: '#/components/schemas/RouterStateDto'
          propertyNames:
            type: integer
            description: The router identifier.
            minimum: 0
        snap_token_public_key:
          type: string
          description: The public key (PEM format) to verify SNAP tokens.
        snaps:
          type: object
          description: The list of SNAPs in the system.
          additionalProperties:
            $ref: '#/components/schemas/SnapStateDto'
          propertyNames:
            type: integer
            description: The SNAP identifier.
            minimum: 0
        topology:
          oneOf:
          - type: 'null'
          - $ref: '#/components/schemas/ScionTopologyDto'
            description: Scion Topology used for routing
    TokenExchangerConfigDto:
      type: object
      description: Token exchanger configuration.
      required:
      - private_key
      - token_lifetime
      - fake_idp
      properties:
        fake_idp:
          $ref: '#/components/schemas/FakeIdpDto'
          description: The fake identity provider for testing.
        private_key:
          type: string
          description: The private key (PEM format) used to sign SNAP tokens.
        token_lifetime:
          type: string
          description: The lifetime of the SNAP tokens.
    TokenExchangerStateDto:
      type: object
      description: The state of the token exchanger.
      required:
      - config
      - id_mapping
      properties:
        config:
          $ref: '#/components/schemas/TokenExchangerConfigDto'
          description: The configuration of the token exchanger.
        id_mapping:
          type: object
          description: List of identity mappings (SSID -> PSSID).
          additionalProperties:
            type: string
          propertyNames:
            type: string
    pocketscion::network::scion::topology::dto::ScionLinkDto:
      type: string
      examples:
      - 1-ff00:0:110 parent_of ff00:0:111
tags:
- name: management
  description: Operations related to the management of Pocket SCION
